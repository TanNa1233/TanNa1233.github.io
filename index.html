<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ระบบขยะ (Tan Kim Kra Sea)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #4e54c8, #8f94fb);
      color: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .box {
      background: rgba(0,0,0,0.5);
      padding: 30px;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button {
      background: #00c9a7;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #00a98f;
    }
    #main-section, #dashboard {
      margin-top: 20px;
    }
    .entry {
      background: rgba(255,255,255,0.15);
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div class="box">
  <h2 style="text-align:center;">ระบบรายงานการทิ้งขยะ</h2>

  <div id="login-section">
    <input type="text" id="username" placeholder="กรอกชื่อ: Tan Kim Kra Sea" />
    <input type="email" id="email" placeholder="(สำหรับผู้ดูแล) อีเมล" />
    <input type="password" id="password" placeholder="รหัสผ่าน" />
    <button onclick="login()">เข้าสู่ระบบ</button>
  </div>

  <div id="main-section" style="display:none;">
    <p>ยินดีต้อนรับ <strong id="userDisplay"></strong></p>
    <input type="number" id="trashCount" placeholder="วันนี้ทิ้งขยะกี่ชิ้น?" />
    <button onclick="submitTrash()">บันทึกข้อมูล</button>
    <button onclick="showData()">ดูข้อมูลทั้งหมด</button>
    <button onclick="logout()" style="background:#f44336;">ออกจากระบบ</button>
  </div>

  <div id="dashboard" style="display:none;">
    <h4>รายการทั้งหมด:</h4>
    <div id="userDataList"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ✅ Firebase Config ตรงนี้ต้องแทนค่าด้วยของคุณเอง
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const adminEmails = ["kawinhinmumu@gmail.com", "40085@streesp.ac.th"];
  let currentUser = "";
  let currentEmail = "";
  let isAdmin = false;

  function login() {
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    
    }
    if (!password) {
      alert("กรุณากรอกรหัสผ่าน");
      return;
    }

    currentUser = username;
    currentEmail = email;
    isAdmin = adminEmails.includes(currentEmail);

    document.getElementById('userDisplay').innerText = currentUser + (isAdmin ? " (Admin)" : "");
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('main-section').style.display = 'block';
  }

  function logout() {
    currentUser = "";
    currentEmail = "";
    isAdmin = false;
    document.getElementById('username').value = "";
    document.getElementById('email').value = "";
    document.getElementById('password').value = "";
    document.getElementById('main-section').style.display = 'none';
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('login-section').style.display = 'block';
  }

  function submitTrash() {
    const count = parseInt(document.getElementById('trashCount').value);
    if (isNaN(count) || count < 0) {
      alert("กรุณากรอกจำนวนขยะที่ถูกต้อง");
      return;
    }

    const entryRef = db.ref("entries").push();
    entryRef.set({
      username: currentUser,
      email: currentEmail || "-",
      trash: count,
      score: 0,
      timestamp: Date.now()
    }).then(() => {
      alert("บันทึกเรียบร้อย");
      document.getElementById('trashCount').value = "";
    });
  }

  function showData() {
    db.ref("entries").get().then(snapshot => {
      const container = document.getElementById('userDataList');
      container.innerHTML = "";
      const data = snapshot.val() || {};
      Object.entries(data).forEach(([id, entry]) => {
        const div = document.createElement('div');
        div.className = "entry";
        div.innerHTML = `
          <strong>${entry.username}</strong><br>
          ขยะ: ${entry.trash} ชิ้น<br>
          คะแนน: ${entry.score || 0}<br>
          ${isAdmin ? `<input type="number" placeholder="เพิ่มคะแนน" onchange="addScore('${id}', this.value)">` : ''}
        `;
        container.appendChild(div);
      });
      document.getElementById('dashboard').style.display = 'block';
    });
  }

  function addScore(id, value) {
    const score = parseInt(value);
    if (isNaN(score)) return;
    if (!isAdmin) {
      alert("คุณไม่มีสิทธิ์เพิ่มคะแนน");
      return;
    }
    const entryRef = db.ref("entries/" + id);
    entryRef.get().then(snapshot => {
      const data = snapshot.val() || {};
      data.score = (data.score || 0) + score;
      return entryRef.set(data);
    }).then(() => showData());
  }
</script>

</body>
</html>
