<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏¢‡∏∞ + ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Firebase)</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; background: #f0f0f0; }
    input, button { padding: 10px; width: 100%; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: teal; color: white; cursor: pointer; }
    button:hover { background: #007b7b; }
    #main-section, #dashboard { display: none; margin-top: 20px; }
    .user-entry { background: white; padding: 10px; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 0 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body>

<h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏¢‡∏∞</h1>

<div id="auth-section">
  <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" />
  <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
  <button onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
  <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div id="main-section">
  <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, <strong id="userDisplay"></strong>!</p>
  <input type="number" id="trashCount" placeholder="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏¢‡∏∞‡πÑ‡∏õ‡∏Å‡∏µ‡πà‡∏ä‡∏¥‡πâ‡∏ô?" />
  <button onclick="submitTrash()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏¢‡∏∞</button>
  <button onclick="showData()">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  <button onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div id="dashboard">
  <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</h3>
  <div id="userDataList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ‡πÉ‡∏™‡πà config ‡∏Ç‡∏≠‡∏á Firebase ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
 const firebaseConfig = {
  apiKey: "AIzaSyBGuJzWWSrUZuTu0yOOyr6no5BvMn0TTCI",
  authDomain: "tan12-39f3c.firebaseapp.com",
  databaseURL: "https://tan12-39f3c-default-rtdb.firebaseio.com",
  projectId: "tan12-39f3c",
  storageBucket: "tan12-39f3c.firebasestorage.app",
  messagingSenderId: "221016907978",
  appId: "1:221016907978:web:c65942c751852b32ff5433",
  measurementId: "G-SJLXXDF97C"
};

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();

  const adminEmails = ["kawinhinmumu@gmail.com", "40085@streesp.ac.th"];
  let currentUser = null;

  

  function login() {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    if (!email || !password) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
      return;
    }
    auth.signInWithEmailAndPassword(email, password)
      .then(userCredential => {
        currentUser = userCredential.user;
        document.getElementById('auth-section').style.display = "none";
        document.getElementById('main-section').style.display = "block";
        document.getElementById('userDisplay').innerText = currentUser.email;
      })
      .catch(error => alert(error.message));
  }

  function logout() {
    auth.signOut().then(() => {
      currentUser = null;
      document.getElementById('auth-section').style.display = "block";
      document.getElementById('main-section').style.display = "none";
      document.getElementById('dashboard').style.display = "none";
      document.getElementById('email').value = '';
      document.getElementById('password').value = '';
      document.getElementById('trashCount').value = '';
    });
  }

  function submitTrash() {
    const count = parseInt(document.getElementById('trashCount').value);
    if (isNaN(count) || count < 0) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      return;
    }
    const userRef = db.ref('users/' + currentUser.uid);
    userRef.get().then(snapshot => {
      const data = snapshot.val() || { trash: 0, score: 0, email: currentUser.email };
      data.trash += count;
      userRef.set(data).then(() => {
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
        document.getElementById('trashCount').value = '';
      });
    });
  }

  function showData() {
    db.ref('users').get().then(snapshot => {
      const users = snapshot.val() || {};
      const container = document.getElementById('userDataList');
      container.innerHTML = '';

      Object.entries(users).forEach(([uid, user]) => {
        const canAddScore = adminEmails.includes(user.email);
        const div = document.createElement('div');
        div.className = 'user-entry';
        div.innerHTML = 
          <strong>${user.email || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•'}</strong><br>
          ‡∏Ç‡∏¢‡∏∞‡∏™‡∏∞‡∏™‡∏°: ${user.trash || 0} ‡∏ä‡∏¥‡πâ‡∏ô<br>
          ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${user.score || 0}<br>
          ${canAddScore ? <input type="number" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" onchange="addScore('${uid}', this.value)"> : ''}
        ;
        container.appendChild(div);
      });

      document.getElementById('dashboard').style.display = 'block';
    });
  }

  function addScore(uid, value) {
    const scoreToAdd = parseInt(value);
    if (isNaN(scoreToAdd)) return;

    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå admin ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    if (!currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");

    if (!adminEmails.includes(currentUser.email)) {
      alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô");
      showData();
      return;
    }

    const userRef = db.ref('users/' + uid);
    userRef.get().then(snapshot => {
      const data = snapshot.val() || { trash: 0, score: 0 };
      data.score += scoreToAdd;
      userRef.set(data).then(() => {
        showData();
      });
    });
  }
  <!-- ‚úÖ Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- ‚úÖ ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì -->
  <script>
    const firebaseConfig = {
      // üîÅ ‡πÉ‡∏™‡πà config ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    const adminEmails = ["kawinhinmumu@gmail.com", "40085@streesp.ac.th"];
    let currentUser = null;

    function register() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if (!email || !password) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
        return;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");
        })
        .catch(error => alert(error.message));
    }

    // ‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById("registerBtn").addEventListener("click", register);
    });
  </script>

</body>
</html>
