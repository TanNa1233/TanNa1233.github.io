<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ระบบขยะ + ผู้ใช้</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 { color: #333; }
    input, button {
      padding: 10px;
      width: 100%;
      margin-top: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: teal;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #007b7b;
    }
    #main-section, #dashboard {
      display: none;
      margin-top: 20px;
    }
    .user-entry {
      background: white;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<h1>ระบบติดตามการทิ้งขยะ</h1>

<div id="auth-section">
  <input type="text" id="username" placeholder="อีเมลผู้ใช้">
  <input type="password" id="password" placeholder="รหัสผ่าน">
  <button onclick="register()">สมัครสมาชิก</button>
  <button onclick="login()">เข้าสู่ระบบ</button>
</div>

<div id="main-section">
  <p>ยินดีต้อนรับ, <strong id="userDisplay"></strong>!</p>
  <input type="number" id="trashCount" placeholder="วันนี้ทิ้งขยะไปกี่ชิ้น?">
  <button onclick="submitTrash()">บันทึกขยะ</button>
  <button onclick="showData()">ดูข้อมูลทั้งหมด</button>
</div>

<div id="dashboard">
  <h3>ข้อมูลผู้ใช้ทั้งหมด:</h3>
  <div id="userDataList"></div>
</div>

<script>
  const USERS_KEY = "users_data";
  let currentUser = null;

  // ✅ เฉพาะคนที่ให้คะแนนได้
  const SCORE_ADMINS = [
    "kawinhinmumu@gmail.com",
    "40085@streesp.ac.th"
  ];

  function getUsers() {
    return JSON.parse(localStorage.getItem(USERS_KEY) || "{}");
  }

  function saveUsers(users) {
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }

  function register() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    if (!username || !password) {
      alert("กรุณากรอกอีเมลและรหัสผ่าน");
      return;
    }

    let users = getUsers();
    if (users[username]) {
      alert("ผู้ใช้นี้มีอยู่แล้ว! กรุณาเข้าสู่ระบบ");
      return;
    }

    users[username] = { password: password, trash: 0, score: 0 };
    saveUsers(users);
    alert("สมัครเรียบร้อย ✅ กรุณาล็อกอิน");
  }

  function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    let users = getUsers();
    if (!users[username]) {
      alert("ไม่พบผู้ใช้ กรุณาสมัครก่อน");
      return;
    }

    if (users[username].password !== password) {
      alert("รหัสผ่านไม่ถูกต้อง");
      return;
    }

    currentUser = username;
    document.getElementById("auth-section").style.display = "none";
    document.getElementById("main-section").style.display = "block";
    document.getElementById("userDisplay").innerText = username;
  }

  function submitTrash() {
    const count = parseInt(document.getElementById('trashCount').value);
    if (isNaN(count) || count < 0) {
      alert("กรุณากรอกจำนวนขยะที่ถูกต้อง");
      return;
    }

    let users = getUsers();
    users[currentUser].trash += count;
    saveUsers(users);

    alert("บันทึกข้อมูลแล้ว ✅");
    document.getElementById('trashCount').value = '';
  }

  function showData() {
    const users = getUsers();
    const container = document.getElementById('userDataList');
    container.innerHTML = '';

    const isScoreAdmin = SCORE_ADMINS.includes(currentUser);

    Object.keys(users).forEach(user => {
      const div = document.createElement('div');
      div.className = 'user-entry';
      div.innerHTML = `
        <strong>${user}</strong><br>
        ขยะสะสม: ${users[user].trash} ชิ้น<br>
        คะแนน: ${users[user].score}<br>
        ${isScoreAdmin ? `<input type="number" placeholder="เพิ่มคะแนน" onchange="addScore('${user}', this.value)">` : ""}
      `;
      container.appendChild(div);
    });

    document.getElementById('dashboard').style.display = 'block';
  }

  function addScore(user, value) {
    if (!SCORE_ADMINS.includes(currentUser)) {
      alert("คุณไม่มีสิทธิ์เพิ่มคะแนน");
      return;
    }

    const score = parseInt(value);
    if (isNaN(score)) return;

    let users = getUsers();
    users[user].score += score;
    saveUsers(users);
    showData(); // รีเฟรชข้อมูล
  }
  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Firebase config — เปลี่ยนเป็นของคุณเองนะ
 const firebaseConfig = {
  apiKey: "AIzaSyBGuJzWWSrUZuTu0yOOyr6no5BvMn0TTCI",
  authDomain: "tan12-39f3c.firebaseapp.com",
  databaseURL: "https://tan12-39f3c-default-rtdb.firebaseio.com",
  projectId: "tan12-39f3c",
  storageBucket: "tan12-39f3c.firebasestorage.app",
  messagingSenderId: "221016907978",
  appId: "1:221016907978:web:c65942c751852b32ff5433",
  measurementId: "G-SJLXXDF97C"
};

  firebase.initializeApp(firebaseConfig);
  <script>
  const adminEmails = ["kawinhinmumu@gmail.com", "40085@streesp.ac.th"];
  let currentUser = null;

  function register() {
    const email = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    if (!email || !password) {
      alert("กรุณากรอกอีเมลและรหัสผ่าน");
      return;
    }

    auth.createUserWithEmailAndPassword(email, password)
      .then(() => {
        alert("สมัครสมาชิกเรียบร้อย ✅ กรุณาล็อกอิน");
      })
      .catch(error => alert(error.message));
  }

  function login() {
    const email = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    if (!email || !password) {
      alert("กรุณากรอกอีเมลและรหัสผ่าน");
      return;
    }

    auth.signInWithEmailAndPassword(email, password)
      .then(userCredential => {
        currentUser = userCredential.user;
        document.getElementById("auth-section").style.display = "none";
        document.getElementById("main-section").style.display = "block";
        document.getElementById("userDisplay").innerText = currentUser.email;
      })
      .catch(error => alert(error.message));
  }

  function submitTrash() {
    const count = parseInt(document.getElementById('trashCount').value);
    if (isNaN(count) || count < 0) {
      alert("กรุณากรอกจำนวนขยะที่ถูกต้อง");
      return;
    }

    const userRef = db.ref('users/' + currentUser.uid);
    userRef.get().then(snapshot => {
      const data = snapshot.val() || {
        email: currentUser.email,
        trash: 0,
        score: 0
      };
      data.trash += count;
      userRef.set(data).then(() => {
        alert("บันทึกเรียบร้อย ✅");
        document.getElementById('trashCount').value = '';
      });
    });
  }

  function showData() {
    db.ref('users').get().then(snapshot => {
      const users = snapshot.val() || {};
      const container = document.getElementById("userDataList");
      container.innerHTML = "";

      Object.entries(users).forEach(([uid, user]) => {
        const isAdmin = adminEmails.includes(currentUser.email);
        const entry = document.createElement("div");
        entry.className = "user-entry";
        entry.innerHTML = `
          <strong>${user.email}</strong><br>
          ขยะสะสม: ${user.trash || 0} ชิ้น<br>
          คะแนน: ${user.score || 0}<br>
          ${isAdmin ? `<input type="number" placeholder="เพิ่มคะแนน" onchange="addScore('${uid}', this.value)">` : ""}
        `;
        container.appendChild(entry);
      });

      document.getElementById("dashboard").style.display = "block";
    });
  }

  function addScore(uid, value) {
    const scoreToAdd = parseInt(value);
    if (isNaN(scoreToAdd)) return;

    if (!adminEmails.includes(currentUser.email)) {
      alert("คุณไม่มีสิทธิ์เพิ่มคะแนน");
      return;
    }

    const userRef = db.ref('users/' + uid);
    userRef.get().then(snapshot => {
      const data = snapshot.val() || { score: 0, trash: 0, email: "" };
      data.score += scoreToAdd;
      userRef.set(data).then(() => {
        showData(); // refresh
      });
    });
  }
</script>

  const auth = firebase.auth();
  const db = firebase.database();
</script>
</script>

</body>
</html>
